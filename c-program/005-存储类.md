# C语言存储类

存储类定义C程序中变量或函数的范围（可见性）和声明周期。这些说明符放置在它们修饰的类型之前。

C语言中可用的存储类如下：
* auto
* register
* static
* extern

#### auto存储类

auto存储类是所有局部变量默认的存储类。auto只能用在函数内，即auto只能修饰局部变量。在程序进入其作用域时创建，在离开其作用域时销毁。

#### register存储类

register存储类用于定义存储在寄存器中而不是RAM中的局部变量。变量的最大尺寸对应寄存器的大小（通常是一个词），且不能对它应用一元的'&'运算符（因为它没有内存位置）。

寄存器只用于在一段时间内需要频繁快速访问的变量，比如计数器。另外，定义`register`并不意味着变量将被存储在寄存器中，它意味着变量可能存储在寄存器中，这取决于硬件和实现。

#### static存储类

static存储类指示编译器在程序的生命周期内保持局部变量的存在，而不需要在它每次进入和离开作用域时进行创建和销毁。因此，使用static修饰局部变量可以在函数调用之间保持局部变量。

static也可以应用于全局变量和函数。static的作用是把变量或函数的作用域限制在声明它的文件内。全局声明的static变量或方法可以被任何函数或方法调用，只要这些方法出现跟static变量或方法在同一文件中。

```c
#include <stdio.h>

/* 函数声明 */
void func1(void);

static int count_static = 10;  /* 全局变量 static是默认的 */
int count = 10;

int main(){
  while(count_static--){
    count--;
    func1();
  }
  return 0;
}

void func1(void){
  static int local_static = 5;
  int local = 5;
  local--;
  local_static--;
  printf("local:%d, local_static:%d, count:%d, count_static:%d",local, local_static, count, count_static);
}
```

#### extern存储类

extern存储类用于提供一个全局变量的引用，全局变量对所有的程序文件都是可见的。当使用extern时，对于无法初始化的变量，会把变量名指向一个之前定义过的存储变量。也就是说声明了全局变量后，还需要调用程序中使用extern再次声明，这与java的public关键字不完全一样。

第一个文件：main.c
```c
#include <stdio.h>
 
int count ;
extern void write_extern();
 
int main()
{
   count = 5;
   write_extern();
   return 0;
}
```

第二个文件：support.c
```c
#include <stdio.h>
 
extern int count;
 
void write_extern(void)
{
   printf("count is %d\n", count);
}
```

编译程序：注意，这两个程序中只有一个main函数，不然不能编译成功。
```shell
gcc main.c support.c
```

## 全局变量，局部变量，静态全局变量，静态局部变量区别

静态全局变量就是加上static的全局变量，静态局部变量就是加上static的局部变量。

* 从作用域来看：
  1. 全局变量具有全局作用域，只用在一个源文件中定义，就可以作用在所有的源文件。注意：在使用之前，需要使用extern再次声明。
  2. 静态局部变量具有局部作用域，只被初始化一次，它只对定义自己的函数可见。
  3. 局部变量与静态局部变量的作用域相同，但是每次调用函数的时候，都会重新初始化，函数结束后会自动销毁。
  4. 静态全局变量也具有全局作用域，但是它只作用于定义它的文件，可以说它具有文件作用域。

* 从分配内存空间看：
  1. 全局变量，静态全局变量，静态局部变量都在静态存储区分配空间，而局部变量在栈内分配空间。
  2. 静态变量会被存放在程序的静态数据存储区（全局可见）。这样可以在下一次调用的时候还可以保持原有的赋值。这一点是它与栈变量和堆变量的区别。
  3. 把局部变量改变为静态变量后是改变了它的存储方式，即生命周期。把全局变量改变为静态变量是改变了它的作用域，限制了使用范围。

注意：
  * 若全局变量仅在单个文件中访问，可以设置为静态全局变量，降低模块间的耦合度。
  * 若全局变量仅由单个函数访问，可以设置为静态局部变量，降低耦合性。
  * 设计和使用访问动态全局变量，静态局部变量，静态局部变量的函数时，需要考虑重入问题，因为它们都放在静态数据存储区，全局可见。
  * 如果我们需要一个可重入的函数，那么要避免函数中使用static变量（这样的函数被称为：带“内部存储器”功能的函数）。
  * 如果函数的返回值为指针类型时，则必须是static的局部变量的地址作为返回值，若为auto类型，则返回为错指针。
